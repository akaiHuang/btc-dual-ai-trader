# v5.9.1 版本說明

## 📊 回測結果對比

| 版本 | 交易筆數 | PnL | 勝率 | 改善 |
|------|---------|------|------|------|
| 原始 | 68 | -$275.07 | 54% | - |
| v5.7 (策略過濾) | 20 | -$50.06 | 65% | +$225 |
| v5.9 (寬止損+無動能) | 20 | -$31.95 | 65% | +$243 |
| **v5.9.1 (新增先漲保護)** | **20** | **-$22.15** | **65%** | **+$253** |

## 🎯 核心策略

### 1. v5.7 策略過濾 (進場過濾)
- ❌ 停止 DISTRIBUTION 做空 (歷史勝率僅 42-48%)
- ✅ 機率區間 75-92% (最佳表現區)
- ✅ OBI 區間 0.2-0.85 (做多時)

### 2. v5.9 無動能快速止損 (新增)
- **觸發條件**: 進場 3 分鐘後，最大獲利 < 1% 且虧損 > 5%
- **原理**: 「從未漲過」的交易 92% 最終虧損
- **效果**: 省 $18.11 (5 筆交易)

### 3. v5.9.1 先漲保護 (新增)
- **觸發條件**: 曾漲超過 4%，但回撤到 0.5% 以下
- **原理**: 保護已有獲利，不讓它變成虧損
- **效果**: 省 $9.80 (2 筆交易)

### 4. 寬止損策略 (恢復)
- **止損**: 12-14% (而非 v5.8 的 5-8%)
- **原理**: 獲利交易中最大回撤達 11.8%，收緊止損會殺死這些交易
- **關鍵發現**: 12 筆「先跌後漲」交易貢獻 +$30 獲利

## 📈 關鍵數據發現

### 走勢模式分析 (v5.7 過濾後 20 筆)
- ✅ 直接上漲獲利: 1 筆
- ✅ 先跌後漲獲利: 12 筆 (+$30.19)
- ❌ 先漲後跌虧損: 2 筆 (-$17.80) → v5.9.1 可挽救
- ❌ 暴跌不回虧損: 5 筆 (-$63.11) → v5.9 可減損

### 風險報酬比
- 平均獲利: +$2.37
- 平均虧損: -$7.57 (v5.9.1 改善後)
- 打平所需勝率: 76.1%
- 實際勝率: 65%
- **差距**: 11.1% (仍需優化)

## ⚠️ 已知限制

1. **勝率仍低於打平點**
   - 需要 76% 勝率打平，目前只有 65%
   - 可能需要更嚴格的進場過濾

2. **無法避免的虧損類型**
   - 小漲 1-3% 後暴跌的交易
   - 這類交易既不觸發無動能止損，也不觸發先漲保護

## 🔧 參數設定

```python
# 止損設定 (寬鬆)
stop_loss_pct: 0.12        # 基礎止損 12%
stop_loss_min_pct: 0.10    # 最小 10%
stop_loss_max_pct: 0.14    # 最大 14%

# 持倉時間 (5-10 分鐘最佳)
max_hold_minutes: 8.0      # 基礎 8 分鐘
max_hold_min_minutes: 5.0  # 最短 5 分鐘
max_hold_max_minutes: 12.0 # 最長 12 分鐘

# 無動能止損
no_momentum_check_after_min: 3.0    # 3 分鐘後檢查
no_momentum_min_profit: 1.0         # 最高需超過 1%
no_momentum_loss_trigger: -5.0      # 虧損 5% 觸發

# 先漲保護
profit_protection_trigger: 4.0      # 曾漲超過 4% 啟動
protection_exit_threshold: 0.5      # 回撤到 0.5% 出場
```

## 📝 下一步優化方向

1. **時段過濾**: 分析虧損交易的時間分布
2. **連續交易限制**: 虧損後暫停 N 分鐘
3. **市場狀態過濾**: 高波動時段謹慎交易
4. **更早止盈**: 當獲利達 3-4% 時考慮部分出場
