# AI-Wolf Bridge å¢å¼·å ±å‘Š

**æ—¥æœŸ**: 2025-11-25  
**ç‰ˆæœ¬**: 2.0 (Enhanced)  
**ç‹€æ…‹**: âœ… å·²å¯¦æ–½

---

## ğŸ“‹ å•é¡Œè¨ºæ–·

### MğŸ³ ç‹€æ…‹
- **è¨ºæ–·çµæœ**: âœ… ç¨‹å¼æ­£å¸¸é‹ä½œ
- **ä¸äº¤æ˜“åŸå› **: æ³¢å‹•ç‡ç¡¬åº•ç·šé˜²è­·è§¸ç™¼
  ```
  ATR = 0.0001% < 0.035% (è¨­å®šé–€æª»)
  â†’ MğŸ³ Volatility Hard Floor: Dead Market
  ```
- **é˜²è­·é‚è¼¯**: ç•¶æ³¢å‹•ç‡ä½æ–¼æ‰‹çºŒè²»æˆæœ¬æ™‚,å¼·åˆ¶ä¸äº¤æ˜“(é˜²è² æœŸæœ›å€¼)
- **çµè«–**: éç¨‹å¼éŒ¯èª¤,æ˜¯å¸‚å ´ç’°å¢ƒä¸ç¬¦åˆäº¤æ˜“æ¢ä»¶

### MğŸº Bridge è³‡æ–™è©•ä¼°
- **åŸºæœ¬åŠŸèƒ½**: âœ… å¯ç”¨
- **å­˜åœ¨å•é¡Œ**: âš ï¸ è³‡è¨Šä¸è¶³,AI ä¿®æ­£èƒ½åŠ›å—é™
  - ç¼ºä¹é¯¨é­šè¡Œç‚ºè¿½è¹¤
  - ç¼ºä¹å¸‚å ´å¾®çµæ§‹æ•¸æ“š
  - ç¼ºä¹æ³¢å‹•ç’°å¢ƒæŒ‡æ¨™
  - ç¼ºä¹é æ¸¬æº–ç¢ºåº¦åé¥‹
  - ç¼ºä¹é¢¨éšªè©•ä¼°æŒ‡æ¨™

---

## ğŸ”§ å¯¦æ–½çš„æ”¹é€²

### Priority 1: æ ¸å¿ƒäº¤æ˜“è³‡è¨Š (ç«‹å³å½±éŸ¿ AI æ±ºç­–)

#### 1.1 é¯¨é­šè¡Œç‚ºè¿½è¹¤
```json
"whale_status": {
  "current_direction": "SHORT",        // ç•¶å‰ä¸»åŠ›æ–¹å‘
  "dominance": 0.65,                   // é›†ä¸­åº¦ (0-1)
  "flip_count_30min": 2,               // 30åˆ†é˜å…§åè½‰æ¬¡æ•¸
  "net_qty_btc": -12.5,                // æ·¨é‡ (BTC)
  "last_flip_time": "2025-11-25T..."   // æœ€å¾Œåè½‰æ™‚é–“
}
```

**AI æ‡‰ç”¨å ´æ™¯**:
- é›†ä¸­åº¦ > 0.85 â†’ å¼·çƒˆä¿¡è™Ÿ,å¯åŠ å¤§æ§“æ¡¿
- flip_count >= 3 â†’ ç–‘ä¼¼æ´—ç›¤,é™ä½ä¿¡å¿ƒåº¦
- direction åè½‰ â†’ è§¸ç™¼ CUT_LOSS æˆ–åå‘é–‹å€‰

#### 1.2 å¸‚å ´å¾®çµæ§‹
```json
"market_microstructure": {
  "obi": -0.45,                        // è¨‚å–®ç°¿å¤±è¡¡ (-1~1)
  "vpin": 0.12,                        // æµå‹•æ€§æ¯’æ€§ (0-1)
  "spread_bps": 0.8,                   // è²·è³£åƒ¹å·® (åŸºé»)
  "funding_rate": -0.01,               // è³‡é‡‘è²»ç‡
  "depth_imbalance": 0.3               // æ·±åº¦å¤±è¡¡æ¯”ä¾‹
}
```

**AI æ‡‰ç”¨å ´æ™¯**:
- OBI < -0.5 ä¸”åšç©º â†’ å¸‚å ´èªåŒ,æŒå€‰
- VPIN > 0.8 â†’ é«˜é¢¨éšªæµå‹•æ€§,ç¸®ç·Šæ­¢æ
- funding_rate > 0.01 â†’ å¤šé ­éç†±,åç©ºç­–ç•¥
- spread_bps > 2.0 â†’ æµå‹•æ€§å·®,é™ä½å€‰ä½

#### 1.3 æ³¢å‹•ç’°å¢ƒ
```json
"volatility": {
  "atr_pct": 0.0001,                   // ATR æ³¢å‹•ç‡ (%)
  "regime": "CONSOLIDATION",           // å¸‚å ´ç‹€æ…‹
  "is_dead_market": true,              // æ­»æ°´ç›¤æ¨™è¨˜
  "bb_width_pct": 0.0012               // å¸ƒæ—å¸¶å¯¬åº¦ (%)
}
```

**AI æ‡‰ç”¨å ´æ™¯**:
- is_dead_market = true â†’ é¿å…äº¤æ˜“
- regime = "TRENDING" â†’ æé«˜æ§“æ¡¿,è¿½è¶¨å‹¢
- atr_pct > 0.1 â†’ é«˜æ³¢å‹•,æ”¾å¯¬æ­¢æ
- bb_width_pct < 0.001 â†’ æº–å‚™çªç ´,è¨­åŸ‹ä¼å–®

---

### Priority 2: é æ¸¬å„ªåŒ– (æå‡ä¿®æ­£ç²¾åº¦)

#### 2.1 é æ¸¬æº–ç¢ºåº¦è¿½è¹¤
```json
"prediction_accuracy": {
  "avg_price_error_pct": 2.25,        // å¹³å‡åƒ¹æ ¼èª¤å·®
  "direction_accuracy_pct": 65.0,     // æ–¹å‘æº–ç¢ºç‡
  "sample_size": 10                   // æ¨£æœ¬æ•¸
}
```

#### 2.2 æ­·å²é æ¸¬è¨˜éŒ„
```json
"recent_predictions": [
  {
    "predicted_price": 87000,
    "actual_price": 88000,
    "error_pct": 1.15,
    "direction_correct": true
  }
  // ... æœ€å¤šä¿ç•™ 10 ç­†
]
```

**AI æ‡‰ç”¨å ´æ™¯**:
- direction_accuracy < 40% â†’ é™ä½ä¿¡å¿ƒåº¦,æ¸›å°‘æ§“æ¡¿
- avg_error > 5% â†’ åƒ¹æ ¼é æ¸¬åå·®å¤§,æ“´å¤§æ­¢æç¯„åœ
- error_pct æŒçºŒé™ä½ â†’ AI æ­£åœ¨å­¸ç¿’,å¯å¢åŠ å€‰ä½

---

### Priority 3: é¢¨éšªç®¡ç† (é•·æœŸå„ªåŒ–)

#### 3.1 é¢¨éšªæŒ‡æ¨™
```json
"risk_indicators": {
  "liquidation_pressure": 45,          // æ¸…ç®—å£“åŠ› (0-100)
  "orderbook_toxicity": 0.12,          // è¨‚å–®ç°¿æ¯’æ€§
  "whale_trap_probability": 0.35       // é¯¨é­šé™·é˜±æ©Ÿç‡ (0-1)
}
```

**AI æ‡‰ç”¨å ´æ™¯**:
- liquidation_pressure > 70 â†’ é«˜é¢¨éšª,é™ä½æ§“æ¡¿æˆ–å¹³å€‰
- whale_trap_probability > 0.6 â†’ ç–‘ä¼¼é™·é˜±,ç­‰å¾…ç¢ºèª
- orderbook_toxicity > 0.8 â†’ æ¥µç«¯ç’°å¢ƒ,é¿å…äº¤æ˜“

---

## ğŸ“ ç¨‹å¼ç¢¼ä¿®æ”¹

### 1. `paper_trading_hybrid_full.py`

#### ä¿®æ”¹ 1: æ“´å±• `_update_wolf_status_to_bridge()`
**ä½ç½®**: Line 3323  
**è®Šæ›´**: å¾ 55 è¡Œæ“´å±•åˆ° 95 è¡Œ  
**æ–°å¢å…§å®¹**:
- é¯¨é­šç‹€æ…‹è¿½è¹¤ (whale_status)
- å¸‚å ´å¾®çµæ§‹æ•¸æ“š (market_microstructure)
- æ³¢å‹•ç’°å¢ƒæ•¸æ“š (volatility)
- é¢¨éšªæŒ‡æ¨™è¨ˆç®— (risk_indicators)

#### ä¿®æ”¹ 2: æ“´å±• `_update_feedback_loop()`
**ä½ç½®**: Line 3376  
**è®Šæ›´**: å¾ 48 è¡Œæ“´å±•åˆ° 85 è¡Œ  
**æ–°å¢å…§å®¹**:
- é æ¸¬æº–ç¢ºåº¦è¿½è¹¤ (prediction_accuracy)
- æ­·å²é æ¸¬è¨˜éŒ„ (recent_predictions, ä¿ç•™æœ€è¿‘ 10 ç­†)
- å¹³å‡èª¤å·®è¨ˆç®—èˆ‡æ–¹å‘æº–ç¢ºç‡

#### ä¿®æ”¹ 3: æ–°å¢è¼”åŠ©å‡½æ•¸
**ä½ç½®**: Line 3438-3490  
**æ–°å¢å‡½æ•¸**:
```python
def _detect_whale_flip(position)           # æª¢æ¸¬æŒå€‰æœŸé–“é¯¨é­šåè½‰
def _calculate_liquidation_pressure(snapshot)  # è¨ˆç®—æ¸…ç®—å£“åŠ› 0-100
def _estimate_whale_trap_probability()      # ä¼°ç®—é¯¨é­šé™·é˜±æ©Ÿç‡ 0-1
```

---

### 2. `ai_trading_advisor.py`

#### ä¿®æ”¹ 1: æ™ºèƒ½è®€å– Bridge è³‡æ–™
**ä½ç½®**: Line 693-780  
**è®Šæ›´**: å¾ç°¡å–® PnL åˆ¤æ–·æ“´å±•åˆ°å¤šç¶­åº¦åˆ†æ  
**æ–°å¢é‚è¼¯**:

```python
# è®€å– Priority 1 æ•¸æ“š
whale_status = wolf_feedback.get('whale_status', {})
micro = wolf_feedback.get('market_microstructure', {})
volatility = wolf_feedback.get('volatility', {})

# è®€å– Priority 2 æ•¸æ“š
prediction_accuracy = feedback_loop.get('prediction_accuracy', {})

# è®€å– Priority 3 æ•¸æ“š
risk_indicators = wolf_feedback.get('risk_indicators', {})

# æ™ºèƒ½è­¦å‘Šç³»çµ±
- é¯¨é­šåè½‰è­¦å‘Š
- æ­»æ°´ç›¤è­¦å‘Š
- æ¥µç«¯é¢¨éšªè­¦å‘Š
- é æ¸¬æº–ç¢ºåº¦è­¦å‘Š
- ç²åˆ©ç¢ºèªèˆ‡ç’°å¢ƒé©—è­‰
```

#### ä¿®æ”¹ 2: è¼¸å‡ºé—œéµæŒ‡æ¨™
**æ–°å¢**: æ¯æ¬¡æ±ºç­–å¾Œé¡¯ç¤ºå¸‚å ´é—œéµæŒ‡æ¨™
```python
print(f"ğŸ“Š Market: {regime} | ATR: {atr_pct:.4f}% | OBI: {obi:.2f} | VPIN: {vpin:.2f} | Fund: {funding_rate:.4f}")
```

---

## ğŸ§ª æ¸¬è©¦èˆ‡é©—è­‰

### æ¸¬è©¦è…³æœ¬
- **æª”æ¡ˆ**: `scripts/test_bridge_enhancement.py`
- **åŠŸèƒ½**:
  1. çµæ§‹å®Œæ•´æ€§æ¸¬è©¦ (16 å€‹å¿…è¦æ¬„ä½)
  2. AI è®€å–èƒ½åŠ›æ¸¬è©¦
  3. å®Œæ•´æ€§è©•åˆ† (0-100%)

### æ¸¬è©¦çµæœ (é æœŸ)
```
âœ… Bridge å®Œæ•´æ€§: 16/16 fields (100%) ğŸ† PERFECT
âœ… AI è®€å–æ¸¬è©¦: PASSED
```

---

## ğŸš€ éƒ¨ç½²æ­¥é©Ÿ

### 1. åœæ­¢ç¾æœ‰ç³»çµ±
```bash
pkill -f ai_trading_advisor.py
pkill -f start_trading_bot.py
```

### 2. å‚™ä»½èˆŠ Bridge
```bash
cp ai_wolf_bridge.json ai_wolf_bridge.backup_$(date +%Y%m%d_%H%M%S).json
```

### 3. é‡å•Ÿç³»çµ± (è‡ªå‹•è…³æœ¬)
```bash
./scripts/restart_ai_system.sh
```

æˆ–æ‰‹å‹•:
```bash
# å•Ÿå‹• AI Advisor
.venv/bin/python scripts/ai_trading_advisor.py &

# ç­‰å¾… 5 ç§’
sleep 5

# å•Ÿå‹• Trading Bot (Mode 8 = MğŸº)
.venv/bin/python start_trading_bot.py 8 &
```

### 4. é©—è­‰ Bridge
```bash
.venv/bin/python scripts/test_bridge_enhancement.py
```

é æœŸçœ‹åˆ°æ‰€æœ‰ âœ… ç¶ è‰²å‹¾é¸ã€‚

---

## ğŸ“Š é æœŸæ•ˆæœ

### AI æ±ºç­–å“è³ªæå‡
| æŒ‡æ¨™ | æ”¹é€²å‰ | æ”¹é€²å¾Œ |
|------|--------|--------|
| è³‡è¨Šç¶­åº¦ | 2 (PnL + Status) | 16 (å…¨æ–¹ä½) |
| é¯¨é­šè¿½è¹¤ | âŒ ç„¡ | âœ… å³æ™‚è¿½è¹¤ |
| å¸‚å ´æ„ŸçŸ¥ | âš ï¸ å»¶é² | âœ… å¯¦æ™‚å¾®çµæ§‹ |
| é¢¨éšªè©•ä¼° | âŒ ç„¡ | âœ… å¤šç¶­åº¦è©•åˆ† |
| é æ¸¬å„ªåŒ– | âŒ ç„¡åé¥‹ | âœ… æ­·å²å­¸ç¿’ |

### å¯¦éš›æ‡‰ç”¨æ¡ˆä¾‹

#### æ¡ˆä¾‹ 1: é¯¨é­šåè½‰æ­¢æ
**å ´æ™¯**: AI é æ¸¬ SHORT,ä½†é¯¨é­šçªç„¶ç¿»å¤š  
**æ”¹é€²å‰**: åªèƒ½çœ‹åˆ° PnL è™§æ,ä¸çŸ¥é“åŸå›   
**æ”¹é€²å¾Œ**: 
```
âš ï¸ WHALE FLIPPED! Now LONG (Dom: 0.82)
â†’ AI ç«‹å³è§¸ç™¼ CUT_LOSS
```

#### æ¡ˆä¾‹ 2: æ­»æ°´ç›¤é¿å…äº¤æ˜“
**å ´æ™¯**: ä½æ³¢å‹•ç’°å¢ƒ,å‹ç‡æ¥µä½  
**æ”¹é€²å‰**: AI ç…§å¸¸ç™¼å‡ºä¿¡è™Ÿ,MğŸº è™§æ  
**æ”¹é€²å¾Œ**:
```
ğŸ’¤ Dead market (ATR: 0.0001%) - low win probability
â†’ AI è‡ªå‹•é™ä½ä¿¡å¿ƒåº¦,MğŸº ä¸äº¤æ˜“
```

#### æ¡ˆä¾‹ 3: é«˜é¢¨éšªè­¦å‘Š
**å ´æ™¯**: æ¸…ç®—å£“åŠ›æ¥µé«˜,å¯èƒ½ç€‘å¸ƒ  
**æ”¹é€²å‰**: AI ç„¡æ„ŸçŸ¥,æŒçºŒæŒå€‰  
**æ”¹é€²å¾Œ**:
```
ğŸ”´ High liquidation risk: 85/100
ğŸª¤ Whale trap probability: 75%
â†’ AI å»ºè­°ç«‹å³æ¸›å€‰
```

#### æ¡ˆä¾‹ 4: ç²åˆ©ç¢ºèª
**å ´æ™¯**: æŒå€‰ç²åˆ©,ä½†é¯¨é­šé–‹å§‹åå‘  
**æ”¹é€²å‰**: AI åªçœ‹ PnL,æŒçºŒæŒå€‰  
**æ”¹é€²å¾Œ**:
```
âš ï¸ Profitable but whale diverging - consider partial exit
â†’ AI å»ºè­°éƒ¨åˆ†æ­¢ç›ˆ
```

---

## ğŸ”® æœªä¾†å„ªåŒ–æ–¹å‘

### Phase 4: æ·±åº¦å­¸ç¿’æ•´åˆ
- ä½¿ç”¨æ­·å² prediction_accuracy è¨“ç·´åƒ¹æ ¼é æ¸¬æ¨¡å‹
- å‹•æ…‹èª¿æ•´ whale_reversal_price ç®—æ³•

### Phase 5: å¤šæ™‚é–“æ¡†æ¶åˆ†æ
- å¢åŠ  1m/5m/15m å¤šé€±æœŸé¯¨é­šè¿½è¹¤
- è·¨é€±æœŸé©—è­‰ä¿¡è™Ÿä¸€è‡´æ€§

### Phase 6: æƒ…ç·’æŒ‡æ¨™
- æ•´åˆ Twitter/Reddit æƒ…ç·’åˆ†æ
- æ–°èäº‹ä»¶å°é¯¨é­šè¡Œç‚ºçš„å½±éŸ¿

---

## ğŸ“ˆ ç›£æ§æŒ‡æ¨™

### æ¯æ—¥æª¢æŸ¥
```bash
# 1. Bridge å¥åº·åº¦
.venv/bin/python scripts/test_bridge_enhancement.py

# 2. AI æ±ºç­–æ—¥èªŒ
tail -f logs/ai_advisor_*.log

# 3. MğŸº äº¤æ˜“è¨˜éŒ„
cat data/paper_trading/pt_*/trading_data.json | jq '.orders.M_AI_WHALE_HUNTER'
```

### é€±åº¦è©•ä¼°
- é æ¸¬æº–ç¢ºç‡è¶¨å‹¢ (direction_accuracy_pct)
- å¹³å‡åƒ¹æ ¼èª¤å·®è®ŠåŒ– (avg_price_error_pct)
- é¢¨éšªæŒ‡æ¨™åˆ†ä½ˆ (liquidation_pressure, whale_trap_probability)

---

## âœ… å®Œæˆæª¢æŸ¥è¡¨

- [x] å¯¦æ–½ Priority 1: é¯¨é­šè¿½è¹¤ + å¸‚å ´å¾®çµæ§‹ + æ³¢å‹•ç’°å¢ƒ
- [x] å¯¦æ–½ Priority 2: é æ¸¬æº–ç¢ºåº¦è¿½è¹¤
- [x] å¯¦æ–½ Priority 3: é¢¨éšªæŒ‡æ¨™è©•ä¼°
- [x] ä¿®æ”¹ Wolf ç‹€æ…‹å›å ±å‡½æ•¸
- [x] ä¿®æ”¹ Feedback Loop å‡½æ•¸
- [x] æ–°å¢è¼”åŠ©è¨ˆç®—å‡½æ•¸
- [x] ä¿®æ”¹ AI è®€å–èˆ‡æ±ºç­–é‚è¼¯
- [x] å‰µå»ºæ¸¬è©¦è…³æœ¬
- [x] å‰µå»ºé‡å•Ÿè…³æœ¬
- [x] æ’°å¯«å®Œæ•´æ–‡æª”
- [ ] é‡å•Ÿç³»çµ±é©—è­‰
- [ ] è§€å¯Ÿ 1 å°æ™‚é‹è¡Œæ•¸æ“š
- [ ] è¨˜éŒ„æ”¹é€²æ•ˆæœ

---

## ğŸ“ å•é¡Œæ’æŸ¥

### Q1: Bridge å®Œæ•´æ€§ < 100%
**æª¢æŸ¥**: æ˜¯å¦å·²é‡å•Ÿ Trading Bot?  
**è§£æ±º**: åŸ·è¡Œ `./scripts/restart_ai_system.sh`

### Q2: AI ä»ç„¶åªçœ‹ PnL
**æª¢æŸ¥**: æ˜¯å¦å·²é‡å•Ÿ AI Advisor?  
**è§£æ±º**: `pkill -f ai_trading_advisor.py && .venv/bin/python scripts/ai_trading_advisor.py &`

### Q3: æ–°æ¬„ä½é¡¯ç¤º N/A
**æª¢æŸ¥**: snapshot æ•¸æ“šæ˜¯å¦åŒ…å«å¿…è¦æ¬„ä½?  
**è§£æ±º**: ç¢ºèª `market_snapshot.json` åŒ…å« obi, vpin, spread_bps ç­‰

### Q4: é¢¨éšªæŒ‡æ¨™ç•°å¸¸
**æª¢æŸ¥**: è¨ˆç®—é‚è¼¯æ˜¯å¦æ­£ç¢º?  
**è§£æ±º**: æŸ¥çœ‹ `_calculate_liquidation_pressure()` å’Œ `_estimate_whale_trap_probability()` å¯¦ç¾

---

**ä½œè€…**: GitHub Copilot  
**å¯©æ ¸**: å¾…ç”¨æˆ¶ç¢ºèª  
**ç”Ÿæ•ˆæ—¥æœŸ**: 2025-11-25 (é‡å•Ÿå¾Œ)
