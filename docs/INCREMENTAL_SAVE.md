# ğŸ”„ å³æ™‚ä¿å­˜æ©Ÿåˆ¶èªªæ˜

## ğŸ“‹ å•é¡Œ

**åŸæœ¬çš„å•é¡Œ**ï¼š
- çµ‚ç«¯æ©Ÿè¼¸å‡ºæœ‰ç·©è¡å€é™åˆ¶ï¼ˆmacOS é è¨­ 10,000 è¡Œæˆ– 2MBï¼‰
- é•·æ™‚é–“æ¸¬è©¦ï¼ˆå¦‚ 3 å°æ™‚ï¼‰æœƒæ´—æ‰èˆŠçš„è¼¸å‡º
- å¦‚æœæ¸¬è©¦ä¸­é€”ç”¨ `Ctrl+Z` ä¸­æ–·ï¼Œæ‰€æœ‰æ•¸æ“šä¸Ÿå¤±
- åªæœ‰åœ¨æ­£å¸¸çµæŸæ™‚æ‰ä¿å­˜ä¸€æ¬¡ JSON

## âœ… è§£æ±ºæ–¹æ¡ˆï¼šå³æ™‚å¢é‡ä¿å­˜

### æ”¹é€²å…§å®¹

#### 1. **å•Ÿå‹•æ™‚å‰µå»ºæª”æ¡ˆ** (ä¿®æ”¹ `__init__`)
```python
# åœ¨æ¸¬è©¦é–‹å§‹æ™‚å°±ç¢ºå®šæª”æ¡ˆåç¨±
self.save_timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
self.json_filename = f"data/paper_trading_{self.save_timestamp}.json"
self.log_filename = f"data/paper_trading_{self.save_timestamp}.log"

# ç«‹å³å‰µå»ºç©ºç™½ JSON æª”æ¡ˆï¼ˆå« metadataï¼‰
self._init_save_file()
```

#### 2. **æ¯ç­†äº¤æ˜“ç«‹å³ä¿å­˜** (æ–°å¢ `_append_order_to_file`)
```python
def _append_order_to_file(self, mode: str, order: 'SimulatedOrder'):
    """æ¯ç­†äº¤æ˜“ç«‹å³è¿½åŠ åˆ° JSON æª”æ¡ˆ"""
    # è®€å– â†’ è¿½åŠ  â†’ å¯«å›
    with open(self.json_filename, 'r', encoding='utf-8') as f:
        data = json.load(f)
    
    data['orders'][mode].append(order.to_dict())
    
    with open(self.json_filename, 'w', encoding='utf-8') as f:
        json.dump(data, f, indent=2, ensure_ascii=False)
```

#### 3. **å¹³å€‰æ™‚è§¸ç™¼ä¿å­˜** (ä¿®æ”¹å¹³å€‰é‚è¼¯)
```python
# åœ¨ check_and_close_positions() ä¸­
position.close(...)
self.balances[mode] += position.pnl_usdt

# ğŸ†• ç«‹å³ä¿å­˜
self._append_order_to_file(mode, position)
```

#### 4. **çµæŸæ™‚æ›´æ–° metadata** (ä¿®æ”¹ `save_order_book`)
```python
def save_order_book(self):
    """æœ€çµ‚ä¿å­˜ï¼ˆæ›´æ–° metadataï¼‰"""
    # è¨‚å–®å·²ç¶“å³æ™‚ä¿å­˜äº†ï¼Œé€™è£¡åªæ›´æ–° metadata
    data['metadata']['total_decisions'] = self.total_decisions
    data['metadata']['end_timestamp'] = ...
    data['metadata']['final_balances'] = self.balances.copy()
```

## ğŸ“Š æ•ˆæœå°æ¯”

### âŒ åŸæœ¬çš„æ–¹å¼
```
16:35:00  é–‹å§‹æ¸¬è©¦
16:35:30  äº¤æ˜“ #1 å®Œæˆ  â†’ åªåœ¨è¨˜æ†¶é«”
16:36:00  äº¤æ˜“ #2 å®Œæˆ  â†’ åªåœ¨è¨˜æ†¶é«”
...
19:29:00  äº¤æ˜“ #600 å®Œæˆ â†’ åªåœ¨è¨˜æ†¶é«”
19:29:30  [Ctrl+Z ä¸­æ–·]  â†’ â˜ ï¸ æ‰€æœ‰æ•¸æ“šä¸Ÿå¤±ï¼
```

### âœ… æ–°çš„æ–¹å¼
```
16:35:00  é–‹å§‹æ¸¬è©¦         â†’ å‰µå»º JSON (ç©ºç™½)
16:35:30  äº¤æ˜“ #1 å®Œæˆ     â†’ ğŸ’¾ ç«‹å³å¯«å…¥ JSON
16:36:00  äº¤æ˜“ #2 å®Œæˆ     â†’ ğŸ’¾ ç«‹å³å¯«å…¥ JSON
...
19:29:00  äº¤æ˜“ #600 å®Œæˆ   â†’ ğŸ’¾ ç«‹å³å¯«å…¥ JSON
19:29:30  [Ctrl+Z ä¸­æ–·]    â†’ âœ… å·²æœ‰ 600 ç­†æ•¸æ“šï¼
```

## ğŸ¯ å„ªå‹¢

1. **æ°¸ä¸ä¸Ÿå¤±æ•¸æ“š** âœ…
   - æ¯ç­†äº¤æ˜“å®Œæˆå¾Œç«‹å³ä¿å­˜
   - å³ä½¿ç¨‹å¼å´©æ½°ã€Ctrl+Z ä¸­æ–·ï¼Œå·²å®Œæˆçš„äº¤æ˜“éƒ½æœ‰è¨˜éŒ„

2. **å³æ™‚ç›£æ§** âœ…
   - å¯ä»¥éš¨æ™‚æ‰“é–‹ JSON æŸ¥çœ‹ç•¶å‰ç‹€æ…‹
   - ä¸éœ€è¦ç­‰æ¸¬è©¦çµæŸ

3. **è¨˜æ†¶é«”å‹å–„** âœ…
   - ä¸éœ€è¦åœ¨è¨˜æ†¶é«”ä¸­ä¿å­˜æ‰€æœ‰è¨‚å–®
   - é•·æ™‚é–“æ¸¬è©¦ä¸æœƒçˆ†è¨˜æ†¶é«”

4. **å®¹éŒ¯èƒ½åŠ›å¼·** âœ…
   - ç¶²è·¯æ–·ç·šã€ç¨‹å¼éŒ¯èª¤éƒ½ä¸å½±éŸ¿å·²ä¿å­˜çš„æ•¸æ“š
   - å¯ä»¥å¾ä¸­æ–·è™•ç¹¼çºŒï¼ˆæœªä¾†å¯å¯¦ç¾ï¼‰

## ğŸ“ æª”æ¡ˆçµæ§‹

æ¸¬è©¦é‹è¡Œä¸­çš„ JSON æª”æ¡ˆï¼š
```json
{
  "metadata": {
    "timestamp": "20251111_163500",
    "initial_capital": 100.0,
    "decision_interval": 15,
    "total_decisions": 150,  // å³æ™‚æ›´æ–°
    "modes": [...],
    "leverage_config": {...}
  },
  "orders": {
    "mode_0_no_risk": [
      {...},  // äº¤æ˜“ #1 (å·²ä¿å­˜)
      {...},  // äº¤æ˜“ #2 (å·²ä¿å­˜)
      {...}   // äº¤æ˜“ #3 (å·²ä¿å­˜)
    ],
    "mode_1_vpin_only": [],
    "mode_2_liquidity_only": [...],
    "mode_3_full_risk": []
  }
}
```

## ğŸ”§ æ€§èƒ½è€ƒé‡

### å¯«å…¥é »ç‡
- åªåœ¨**å¹³å€‰æ™‚**å¯«å…¥ï¼ˆä¸æ˜¯æ¯ç§’ï¼‰
- å…¸å‹ 3 å°æ™‚æ¸¬è©¦ï¼šMode 0 ç´„ 600 ç­† = æ¯ 18 ç§’ä¸€æ¬¡å¯«å…¥
- å° SSD å®Œå…¨ç„¡å£“åŠ›

### æª”æ¡ˆå¤§å°
- å–®ç­†è¨‚å–®ç´„ 500-800 bytes (å«æ ¼å¼åŒ–)
- 600 ç­†è¨‚å–® â‰ˆ 300-500 KB
- å³ä½¿ 10,000 ç­†ä¹Ÿåªæœ‰ 5-8 MB

### JSON è®€å¯«æ•ˆèƒ½
```python
# æ¯æ¬¡å¯«å…¥è€—æ™‚ < 10ms
è®€å–: ~2ms (500KB JSON)
è§£æ: ~3ms
è¿½åŠ : ~1ms
åºåˆ—åŒ–: ~2ms
å¯«å…¥: ~2ms
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ç¸½è¨ˆ: ~10ms âœ… å¯æ¥å—
```

## âš ï¸ æ³¨æ„äº‹é …

1. **ä¸è¦æ‰‹å‹•ç·¨è¼¯é‹è¡Œä¸­çš„ JSON**
   - ç¨‹å¼æœƒè¦†è“‹æ‚¨çš„ä¿®æ”¹
   - ç­‰æ¸¬è©¦çµæŸå†ç·¨è¼¯

2. **ç£ç¢Ÿç©ºé–“**
   - ç¢ºä¿ `data/` ç›®éŒ„æœ‰è¶³å¤ ç©ºé–“
   - æ¯æ¬¡æ¸¬è©¦ 1-10 MB

3. **å´©æ½°æ¢å¾©**
   - ç•¶å‰ç‰ˆæœ¬ä¸æ”¯æ´å¾ä¸­æ–·è™•ç¹¼çºŒ
   - ä½†å·²ä¿å­˜çš„æ•¸æ“šä¸æœƒä¸Ÿå¤±

## ğŸš€ ä½¿ç”¨æ–¹å¼

å®Œå…¨é€æ˜ï¼ä¸éœ€è¦ä»»ä½•æ”¹è®Šï¼š

```bash
# ä¸€æ¨£çš„æŒ‡ä»¤
.venv/bin/python scripts/paper_trading_system.py 180

# ä½†ç¾åœ¨:
# 1. é–‹å§‹æ™‚æœƒé¡¯ç¤º: ğŸ’¾ å³æ™‚ä¿å­˜å·²å•Ÿå‹•: data/paper_trading_XXXXXX.json
# 2. æ¯ç­†äº¤æ˜“å®Œæˆå¾Œè‡ªå‹•ä¿å­˜ï¼ˆç„¡è¼¸å‡ºï¼Œé¿å…å¹²æ“¾ï¼‰
# 3. éš¨æ™‚å¯ä»¥ Ctrl+Z ä¸­æ–·ï¼Œæ•¸æ“šå·²ä¿å­˜
```

## ğŸ“Š ç›£æ§é‹è¡Œä¸­çš„æ¸¬è©¦

```bash
# å³æ™‚æŸ¥çœ‹å·²å®Œæˆçš„äº¤æ˜“æ•¸
watch -n 5 'cat data/paper_trading_20251111_163500.json | grep "order_id" | wc -l'

# æŸ¥çœ‹æœ€æ–°é¤˜é¡ï¼ˆå¦‚æœæœ‰åˆ†æå·¥å…·ï¼‰
.venv/bin/python scripts/analyze_paper_trading.py data/paper_trading_20251111_163500.json
```

## ğŸ”® æœªä¾†æ”¹é€²

1. **æ–·é»çºŒè·‘**
   - å¾ä¸Šæ¬¡ä¸­æ–·è™•ç¹¼çºŒæ¸¬è©¦
   - ä¿ç•™åŸæœ‰è¨‚å–®è¨˜éŒ„

2. **åˆ†æª”å„²å­˜**
   - æ¯ 100 ç­†è¨‚å–®ä¸€å€‹æª”æ¡ˆ
   - é¿å…å–®æª”éå¤§

3. **å£“ç¸®å„²å­˜**
   - ä½¿ç”¨ gzip å£“ç¸® JSON
   - ç¯€çœ 70% ç©ºé–“

4. **è³‡æ–™åº«ç‰ˆæœ¬**
   - ä½¿ç”¨ SQLite å–ä»£ JSON
   - æ›´å¿«çš„æŸ¥è©¢èˆ‡åˆ†æ

---

**ç¸½çµ**ï¼šå³æ™‚ä¿å­˜æ©Ÿåˆ¶ç¢ºä¿æ‚¨æ°¸é ä¸æœƒå› ç‚ºä¸­æ–·è€Œä¸Ÿå¤±æ•¸æ“šï¼ğŸ¯
