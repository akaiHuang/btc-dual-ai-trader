# 🦅 dYdX 手續費極速刷單策略確認書 (Strategy Verification)

## 1. 策略核心邏輯 (Core Logic)
在 dYdX Maker/Taker 有手續費環境下，我們採用 **「極速刷單 (Ultra-High Frequency Scalping)」** 策略。
與 Binance 相比，若盡量使用 **Maker (Post-only)**，交易成本較低，但仍需覆蓋手續費與滑點/點差。

### 關鍵優勢
- **成本可控**：Maker 費率較低，但 50x 會把費用放大成 ROE，必須納入門檻。
- **速度為王**：持有時間從「分鐘級」縮短為「秒級」（但要避免 Taker 來回費用侵蝕）。
- **積沙成塔**：單筆獲利雖小，但每日頻次極高（前提是大多數成交為 Maker）。

---

## 2. 參數特徵確認 (Parameters)

| 參數名稱 | 當前代碼設定 (Current) | dYdX 建議設定 (Target) | 狀態 | 說明 |
| :--- | :--- | :--- | :--- | :--- |
| **反轉最小持倉** (`min_hold_for_reversal`) | **300.0 秒 (5分鐘)** | **0.0 - 1.0 秒** | 🔴 需修改 | 解除封印，允許秒進秒出 |
| **反轉觸發閾值** (`three_line_exit_threshold`) | **15.0 秒** | **3.0 - 5.0 秒** | 🔴 需修改 | 提高敏感度，發現不對立即跑 |
| **手續費率** (`maker_fee_pct` / `taker_fee_pct`) | `0.005` / `0.04` | `0.005` / `0.04` | ✅ 已就緒 | 用於淨利計算與觸發門檻 |
| **目標獲利** (`target_profit_pct`) | `0.40` (0.4%) | `0.15` - `0.25` | 🟡 建議降低 | 容易達標，提高周轉率 |
| **無動能止損** (`no_momentum_check`) | `3.0` 分鐘 | `0.5` 分鐘 | 🟡 建議縮短 | 資金不滯留，無效單快速平倉 |

> [!IMPORTANT]
> **您目前的代碼中，`min_hold_for_reversal` 仍為 300 秒。**
> 請務必修改 `scripts/whale_testnet_trader.py` 第 2910 行，否則無法執行極速刷單。

---

## 3. 特徵訊號 (Signal Characteristics)

### 🚀 進場信號 (Entry)
主要依賴 **WhaleStrategyDetector** 的高勝率模式：

1.  **盤整洗盤 (CONSOLIDATION_SHAKE)**
    - **特徵**: 價格在小區間橫盤，OBI (訂單簿) 突然失衡。
    - **邏輯**: 散戶失去耐心離場，主力吸籌。
    - **dYdX應用**: 這是刷單的最佳進場點，因為盤整突破通常很短暫但明確。

2.  **三線共振 (Three Line Alignment)**
    - **特徵**: 快線(5s)、中線(30s)、慢線(5m) 趨勢一致。
    - **dYdX應用**: 順勢秒殺。

### 🔄 出場信號 (Exit) - 最關鍵！
dYdX 策略的靈魂在於 **出場**。

1.  **三線反轉 (Three Line Reversal) - 王牌機制**
    - **邏輯**: 持倉時，如果對手盤勢力突然增強 (例如持多單時，空方力量累積超過 3秒)。
    - **動作**: **立即平倉**。
    - **勝率**: 歷史回測顯示此機制在低費率 (Maker 優先) 下勝率高達 **90%**。
    - **備註**: 在 Binance 因為手續費太貴，這被視為「噪音」；在 dYdX 這是「神諭」。

---

## 4. 止盈止損策略 (TP/SL Strategy)

### 止盈 (Take Profit)
- **類型**: 固定極小目標 + 動態追蹤
- **設定**: `0.2%` (Gross)
- **邏輯**: "Hit and Run"。只要有小利潤就入袋為安，不期待單邊大行情。

### 止損 (Stop Loss)
- **類型**: 時間止損 + 反轉止損
- **設定**: `0.1%` 或 **三線反轉信號觸發**
- **邏輯**:
    1. **信號反轉**: 只要信號不對 (三線反轉)，立刻平倉，不管虧損多少 (通常很小)。
    2. **時間止損**: 進場 30 秒不動，平倉走人 (資金效率優先)。

---

## 5. 執行確認 (Execution Check)

確認您的機器人日誌 (Logs) 中出現以下行為，即代表 dYdX 策略運作正常：
1.  **頻率高**: 一分鐘內可能有多次 `OPEN` 和 `CLOSED`。
2.  **持倉短**: `Duration` 顯示為 `2s`, `5s`, `8s` 等個位數秒數。
3.  **理由**: 平倉理由頻繁出現 `THREE_LINE_REVERSAL`。
4.  **費用**: 交易手續費不再為 `$0.00`，應顯示 Maker/Taker 費率或費用金額。
